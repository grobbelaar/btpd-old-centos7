{
  "startup": {},
  "config": {
    "enabled": true,
    "reload_sighup": true,
    "reload_changed_ms": 1000
  },
  "core": {
    "sys-cpu": [1,2,3,4,5,6,7],
    "wfc-cpu": [0,2,3,4,5,6,7,16,17,18,19,20,21],
    "common-workflow": {
    	"control_ms": 1000,
        "debug": false,
        "maxsize": 134217728,
        "threads": 2,
        "wrnsize": 1048576
    }
  },
  "logger": {
    "enabled": true,
    "startup_priority": -1000,
    "shutdown_priority": 1000,
    "milliseconds": true,
    "abort_with_fatal_message":true,
    "limit": 100000000,
    "stdout": "clog",
    "path": "/logs/oracoll"
  },

  "workflow": [
    {
      "name": "workflow1",
      "enabled": true,
      "wrnsize": 128,
      "maxsize": 10240,
      "control_ms": 1000,
      "threads": 1,
      "post_delay_ms": 0,
      "rate_limit": 0,
      "cpu": [/*28*/]
    },

    {
      "name": "workflow2",
      "enabled": true,
      "wrnsize": 64,
      "maxsize": 128,
      "control_ms": 5000,
      "threads": 15,
      "post_delay_ms": 0,
      "rate_limit": 0,
      "cpu": [8,9,10,11,12,13,14,15,24,25,26,27,28,29,30]
    },

    {
      "name": "workflow3",
      "enabled": true,
      "wrnsize": 1600,
      "maxsize": 3200,
      "control_ms": 1000,
      "threads": 4,
      "post_delay_ms": 0,
      "rate_limit": 0,
      "cpu": [/*27*/]
    },

    {
      "name": "oracoll-workflow",
      "enabled": true,
      "wrnsize": 128,
      "maxsize": 256,
      "control_ms": 1000,
      "threads": 1,
      "post_delay_ms": 0,
      "rate_limit": 0,
      "cpu": [31]
    }
  ],

  "server-tcp": [
    {
      "name": "server-tcp1",
      "enabled": true,
      "suspend": false,
      "startup_priority":   1000,
      "shutdown_priority": -1000,

      "workflow": "",
      "target": "jsonrpc-broker1",
      "keep-alive": true,
      "threads":   2,
      "cpu":[/*29,30*/],
      "addr": "0.0.0.0",
      "port": "32347",
      "connection": {
        "reader":{"sep": "\r\n"},
        "writer": {"sep": "\r\n"}
      }
    }
  ],

  "server-udp": [
    {
      "name": "server-udp1",
      "enabled": true,
      "suspend": false,
      "startup_priority":   1000,
      "shutdown_priority": -1000,
      "target": "oracoll-service1",
      "threads": 2,
      "addr": "0.0.0.0",
      "port": "32347"
    }
  ],

  "jsonrpc-broker": [
    {
      "name": "jsonrpc-broker1",
      "enabled": true,
      "suspend": false,
      "startup_priority": 0,
      "shutdown_priority": 0,
      "target": "jsonrpc-queue1",
      "reject": [/*"recommend_for"*/],
      "rules": [
        {
          "target":"jsonrpc-queue2",
          "methods":["recommend_for"]
        }
      ]
    }
  ],

  "jsonrpc-queue": [
    {
      "name": "jsonrpc-queue1",
      "enabled": true,
      "suspend": false,
      "startup_priority": 0,
      "shutdown_priority": 0,
      "workflow": "workflow1",
      "target": "oracoll-service1",
      "callback_queue": false,
      "callback_workflow": ""
    },
    {
      "name": "jsonrpc-queue2",
      "enabled": true,
      "suspend": false,
      "startup_priority": 0,
      "shutdown_priority": 0,
      "workflow": "workflow2",
      "target": "oracoll-service2",
      "callback_queue": true,
      "callback_workflow": "workflow3"
    }
  ],

  "oracoll-service": [
    {
      "name": "oracoll-service1",
      "enabled": true,
      "suspend": false,
      "workflow": "",
      "target": "oracoll1",
      "allow_non_jsonrpc": false,
      "call_lifetime_ms": 60000,
      "remove_everytime": true,
      "disable_handler_map": true,
      "remove_outdated_ms": 0
    },
    {
      "name": "oracoll-service2",
      "enabled": true,
      "suspend": false,
      "workflow": "",
      "target": "oracoll1",
      "allow_non_jsonrpc": false,
      "call_lifetime_ms": 60000,
      "remove_everytime": true,
      "disable_handler_map": true,
      "remove_outdated_ms": 0
    }
  ],

  "oracoll": [
    {
      "name": "oracoll1",
      "enabled": true,
      "suspend": false,
      "startup_priority": -100,
      "shutdown_priority": 0,
      "workflow": "oracoll-workflow",
      "load_after_start":true,
      "similar_limit": 100 /*10000*/,
      "reserve_votes":70000000,
      "user_vote_limit":  100  /*500*/,
      "photo_vote_limit": 150  /*500*/,  /* лучше больше, иначе неактуальные пользователи, т.к. нет индекса по фото и дате голоса */
      "voter_vote_limit": 100  /*1000*/,
      "dislike_correction":true,
      "miss_correction":false,
      "debug_nousers":false,
      "debug_data_check": false,
      "delayed_upsert_votes": true,
      "delayed_vote_index": true,
      "double_storage_mode": true,
      "radiuses":[1,2,3,5,10,20,50,100,250,500],
      "vote_ranges":[3,5,10,100,200,500,1000],
      "time_ranges":[
          86400,   /* До 24 часов   */
          259200,  /* До 3х дней    */
          604800,  /* До недели     */
          1209600, /* До 2х недель  */
          2678400, /* До месяца     */
          5184000, /* До 2х месяцев */
          7776000  /* До 3х месяцев */
      ],

      "db": {
        "votes": {
          "user": "mamba",
          "pass": "hikOphaut6",
          "cluster": "cluster.json",
          "chunk": 1000,
          "timespan": /*1209600*/ /*604800*/ 2592000 /*3600*/ /*86400*/
        },
        "users": {
          "addr": "10.5.4.4",
          "user": "mamba",
          "pass": "hikOphaut6",
          "port": 3306,
          "chunk": 1000000,
          "threads": 16
        },
        "coords": {
          "addr": "10.5.4.9",
          "user": "mamba",
          "pass": "hikOphaut6",
          "port": 3306,
          "chunk": 1000000,
          "threads": 8
        }
      }
    }
  ]
}
